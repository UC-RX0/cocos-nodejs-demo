{"version":3,"sources":["file:///D:/CocosProject/cocos-nodejs-io-game-start-demo-master/apps/client/assets/Scripts/Scene/HallManager.ts"],"names":["_decorator","Component","director","instantiate","Node","Prefab","NetworkManager","ApiMsgEnum","PlayerManager","DataManager","EventEnum","SceneEnum","RoomManager","EventManager","ccclass","property","HallManager","onLoad","Instance","listenMsg","MsgPlayerList","renderPlayer","MsgRoomList","renderRoom","on","JoinRoom","handleJoinRoom","start","RoomList","removeAllChildren","PlayerList","getPlayers","getRooms","onDestroy","unListenMsg","off","success","error","res","callApi","ApiPlayerList","console","log","ApiRoomList","Rooms","c","children","active","length","RoomPrefab","parent","i","data","node","getComponent","init","rid","ApiRoomJoin","roomInfo","room","loadScene","Room","Players","PlayerPrefab","handleCreateRoom","ApiRoomCreate"],"mappings":"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","sourcesContent":["import { _decorator, Component, director, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { NetworkManager } from '../Global/NetworkManager';\r\nimport { ApiMsgEnum, IApiPlayerListRes, IApiRoomListRes } from '../Common';\r\nimport { PlayerManager } from '../UI/PlayerManager';\r\nimport DataManager from '../Global/DataManager';\r\nimport { EventEnum, SceneEnum } from '../Enum';\r\nimport { RoomManager } from '../UI/RoomManager';\r\nimport EventManager from '../Global/EventManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HallManager')\r\nexport class HallManager extends Component {\r\n    @property(Node)\r\n    PlayerList: Node = null;\r\n    @property(Prefab)\r\n    PlayerPrefab: Prefab = null\r\n    @property(Node)\r\n    RoomList: Node = null;\r\n    @property(Prefab)\r\n    RoomPrefab: Prefab = null\r\n    onLoad(): void {\r\n        NetworkManager.Instance.listenMsg(ApiMsgEnum.MsgPlayerList, this.renderPlayer, this)\r\n        NetworkManager.Instance.listenMsg(ApiMsgEnum.MsgRoomList, this.renderRoom, this)\r\n        EventManager.Instance.on(EventEnum.JoinRoom, this.handleJoinRoom, this)\r\n\r\n    }\r\n    start(): void {\r\n        this.RoomList.removeAllChildren();\r\n        this.PlayerList.removeAllChildren();\r\n        this.getPlayers()\r\n        this.getRooms()\r\n    }\r\n    protected onDestroy(): void {\r\n        NetworkManager.Instance.unListenMsg(ApiMsgEnum.MsgPlayerList, this.renderPlayer, this)\r\n        NetworkManager.Instance.unListenMsg(ApiMsgEnum.MsgRoomList, this.renderRoom, this)\r\n        EventManager.Instance.off(EventEnum.JoinRoom, this.handleJoinRoom, this)\r\n    }\r\n    async getPlayers() {\r\n        const { success, error, res } = await NetworkManager.Instance.callApi(ApiMsgEnum.ApiPlayerList, {});\r\n        if (!success) {\r\n            console.log(\"加入失败\", error);\r\n            return;\r\n        }\r\n        this.renderPlayer(res)\r\n    }\r\n    async getRooms() {\r\n        const { success, error, res } = await NetworkManager.Instance.callApi(ApiMsgEnum.ApiRoomList, {});\r\n        if (!success) {\r\n            console.log(\"加入失败\", error);\r\n            return;\r\n        }\r\n        this.renderRoom(res)\r\n    }\r\n    renderRoom({ Rooms }: IApiRoomListRes) {\r\n        for (const c of this.RoomList.children) {\r\n            c.active = false;\r\n        }\r\n\r\n\r\n        while (this.RoomList.children.length < Rooms.length) {\r\n            const c = instantiate(this.RoomPrefab);\r\n            c.active = false;\r\n            c.parent = this.RoomList;\r\n        }\r\n\r\n        for (let i = 0; i < Rooms.length; i++) {\r\n            const data = Rooms[i];\r\n            const node = this.RoomList.children[i]\r\n            node.getComponent(RoomManager).init(data)\r\n        }\r\n    }\r\n    async handleJoinRoom(rid: number) {\r\n        const { success, error, res } = await NetworkManager.Instance.callApi(ApiMsgEnum.ApiRoomJoin, {\r\n            rid,\r\n        });\r\n        if (!success) {\r\n            console.log(\"加入失败\", error);\r\n            return;\r\n        }\r\n        DataManager.Instance.roomInfo = res.room;\r\n        console.log(\"创建房间成功\", res);\r\n        director.loadScene(SceneEnum.Room)\r\n    }\r\n    renderPlayer({ Players }: IApiPlayerListRes) {\r\n        for (const c of this.PlayerList.children) {\r\n            c.active = false;\r\n        }\r\n\r\n\r\n        while (this.PlayerList.children.length < Players.length) {\r\n            const c = instantiate(this.PlayerPrefab);\r\n            c.active = false;\r\n            c.parent = this.PlayerList;\r\n        }\r\n\r\n        for (let i = 0; i < Players.length; i++) {\r\n            const data = Players[i];\r\n            const node = this.PlayerList.children[i]\r\n            node.getComponent(PlayerManager).init(data)\r\n        }\r\n\r\n    }\r\n\r\n    async handleCreateRoom() {\r\n        const { success, error, res } = await NetworkManager.Instance.callApi(ApiMsgEnum.ApiRoomCreate, {});\r\n        if (!success) {\r\n            console.log(\"加入失败\", error);\r\n            return;\r\n        }\r\n        DataManager.Instance.roomInfo = res.room;\r\n        console.log(\"创建房间成功\", res);\r\n        director.loadScene(SceneEnum.Room)\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}