{"version":3,"sources":["file:///D:/CocosProject/cocos-nodejs-io-game-start-demo-master/apps/client/extensions/Behavior%20Eden/src/runtime/core/utils.ts"],"names":["postOrder","root","stack","stack2","result","length","node","pop","push","i","children","buildTree","_nodes","nodes","deepClone","nodeMap","Map","isRoot","set","id","map","childId","get","bfsCcNode","targetUuid","dirtyUuid","target","queue","myWhile","len","item","uuid","j","child","unshift","preOrder","obj","res","Array","isArray","key","Object","prototype","hasOwnProperty","call"],"mappings":"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","sourcesContent":["import { AbortType } from \"../node\";\r\n\r\n// 树状节点形式\r\ntype NodeTree = { id: string; type: string; abortType: AbortType; isRoot: boolean; children: Array<NodeTree> };\r\n\r\n/***\r\n * N叉树的倒序遍历\r\n */\r\nexport const postOrder = function (root: NodeTree) {\r\n  if (!root) {\r\n    return [];\r\n  }\r\n\r\n  const stack = [root];\r\n  const stack2 = [];\r\n  const result = [];\r\n  while (stack.length) {\r\n    const node = stack.pop()!;\r\n    stack2.push(node);\r\n    for (let i = 0; i < node.children.length; i++) {\r\n      stack.push(node.children[i]);\r\n    }\r\n  }\r\n\r\n  while (stack2.length) {\r\n    result.push(stack2.pop()!);\r\n  }\r\n  return result;\r\n};\r\n\r\n/**\r\n * 数组转树，返回根节点\r\n * @param nodes\r\n * @returns root\r\n */\r\nexport const buildTree = (_nodes: any) => {\r\n  // 防止修改有原数据\r\n  const nodes = deepClone(_nodes);\r\n  const nodeMap: Map<string, any> = new Map();\r\n\r\n  let root: NodeTree | null = null;\r\n  // 记录id和node数据的映射\r\n  for (const node of nodes) {\r\n    if (node.isRoot) {\r\n      root = node;\r\n    }\r\n    nodeMap.set(node.id, node);\r\n  }\r\n\r\n  // 没有根节点\r\n  if (!root) {\r\n    return null;\r\n  }\r\n\r\n  // 把children中的Id换成真正的node数据\r\n  for (const node of nodes) {\r\n    node.children = node.children.map((childId: any) => nodeMap.get(childId)!);\r\n  }\r\n\r\n  //  返回根节点\r\n  return root;\r\n};\r\n\r\n/***\r\n * BFS开始\r\n * 从当前节点开始层序遍历\r\n * 找不到再从scene节点开始层序遍历\r\n * dirtyNode代表需要跳过的节点，避免scene场景重复遍历curNode\r\n */\r\nexport const bfsCcNode = (root: any, targetUuid: string, dirtyUuid?: string) => {\r\n  let target = null;\r\n\r\n  let queue = [root];\r\n  // 给while循环起名\r\n  myWhile: while (queue.length) {\r\n    const len = queue.length;\r\n    for (let i = 0; i < len; i++) {\r\n      const item = queue.pop();\r\n      const uuid = item.uuid;\r\n      if (uuid === targetUuid) {\r\n        target = item;\r\n        // 找到目标，直接退出while循环\r\n        break myWhile;\r\n      }\r\n      for (let j = 0; j < item.children.length; j++) {\r\n        const child = item.children[j];\r\n        // 跳过已经遍历过的节点\r\n        if (dirtyUuid && child.uuid === dirtyUuid) {\r\n          continue;\r\n        }\r\n        queue.unshift(child);\r\n      }\r\n    }\r\n  }\r\n\r\n  return target;\r\n};\r\n\r\nexport const preOrder = function (root: any) {\r\n  if (!root) {\r\n    return [];\r\n  }\r\n  var stack = [root];\r\n  var result = [];\r\n  while (stack.length) {\r\n    const item = stack.pop();\r\n    for (let i = item.children.length - 1; i >= 0; i--) {\r\n      stack.push(item.children[i]);\r\n    }\r\n    result.push(item);\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n/***\r\n * 深克隆\r\n */\r\nexport const deepClone = (obj: any) => {\r\n  if (typeof obj !== \"object\" || obj === null) {\r\n    return obj;\r\n  }\r\n\r\n  const res: any = Array.isArray(obj) ? [] : {};\r\n  for (const key in obj) {\r\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n      res[key] = deepClone(obj[key]);\r\n    }\r\n  }\r\n\r\n  return res;\r\n};\r\n"]}