{"version":3,"sources":["file:///D:/CocosProject/cocos-nodejs-io-game-start-demo-master/apps/client/assets/Scripts/Global/ObjectPoolManager.ts"],"names":["ObjectPoolManager","instantiate","Node","Singleton","DataManager","ObjectPool","map","Map","Instance","GetInstance","get","type","setParent","stage","has","set","container","nodes","length","prefab","prefabMap","node","name","active","getChildByName","pop","ret","push"],"mappings":";;;0HAOqBA,iB;;;;;;;;;;;;;;;;;;;;;;;AAFZC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;;AAHfC,MAAAA,S;;AAIAC,MAAAA,W;;;;;;;;;yBACcJ,iB,GAAN,MAAMA,iBAAN;AAAA;AAAA,kCAA0C;AAAA;AAAA;AAAA,eAK7CK,UAL6C;AAAA,eAM7CC,GAN6C,GAMV,IAAIC,GAAJ,EANU;AAAA;;AAClC,mBAARC,QAAQ,GAAG;AAClB,iBAAO,MAAMC,WAAN,EAAP;AACH;;AAKDC,QAAAA,GAAG,CAACC,IAAD,EAAuB;AACtB,cAAI,CAAC,KAAKN,UAAV,EAAsB;AAClB,iBAAKA,UAAL,GAAkB,IAAIH,IAAJ,CAAS,YAAT,CAAlB;AACA,iBAAKG,UAAL,CAAgBO,SAAhB,CAA0B;AAAA;AAAA,4CAAYJ,QAAZ,CAAqBK,KAA/C;AACH;;AACD,cAAI,CAAC,KAAKP,GAAL,CAASQ,GAAT,CAAaH,IAAb,CAAL,EAAyB;AACrB,iBAAKL,GAAL,CAASS,GAAT,CAAaJ,IAAb,EAAmB,EAAnB;AACA,gBAAMK,SAAS,GAAG,IAAId,IAAJ,CAASS,IAAI,GAAG,MAAhB,CAAlB;AACAK,YAAAA,SAAS,CAACJ,SAAV,CAAoB,KAAKP,UAAzB;AACH;;AACD,cAAMY,KAAK,GAAG,KAAKX,GAAL,CAASI,GAAT,CAAaC,IAAb,CAAd;;AACA,cAAI,CAACM,KAAK,CAACC,MAAX,EAAmB;AACf,gBAAMC,MAAM,GAAG;AAAA;AAAA,4CAAYX,QAAZ,CAAqBY,SAArB,CAA+BV,GAA/B,CAAmCC,IAAnC,CAAf;AACA,gBAAMU,IAAI,GAAGpB,WAAW,CAACkB,MAAD,CAAxB;AACAE,YAAAA,IAAI,CAACC,IAAL,GAAYX,IAAZ;AACAU,YAAAA,IAAI,CAACE,MAAL,GAAc,IAAd;AACAF,YAAAA,IAAI,CAACT,SAAL,CAAe,KAAKP,UAAL,CAAgBmB,cAAhB,CAA+Bb,IAAI,GAAG,MAAtC,CAAf;AACA,mBAAOU,IAAP;AACH,WAPD,MAOO;AACH,gBAAMA,KAAI,GAAGJ,KAAK,CAACQ,GAAN,EAAb;;AACAJ,YAAAA,KAAI,CAACE,MAAL,GAAc,IAAd;AACA,mBAAOF,KAAP;AACH;AAEJ;;AACDK,QAAAA,GAAG,CAACL,IAAD,EAAa;AACZA,UAAAA,IAAI,CAACE,MAAL,GAAc,KAAd;AACA,eAAKjB,GAAL,CAASI,GAAT,CAAaW,IAAI,CAACC,IAAlB,EAA0CK,IAA1C,CAA+CN,IAA/C;AACH;;AApCoD,O","sourcesContent":["\r\n\r\nimport Singleton from \"../Base/Singleton\";\r\nimport { EntityTypeEnum } from \"../Common\";\r\nimport { EventEnum } from \"../Enum\";\r\nimport { instantiate, Node } from \"cc\";\r\nimport DataManager from \"./DataManager\";\r\nexport default class ObjectPoolManager extends Singleton {\r\n    static get Instance() {\r\n        return super.GetInstance<ObjectPoolManager>();\r\n    }\r\n\r\n    private ObjectPool: Node\r\n    private map: Map<EntityTypeEnum, Node[]> = new Map();\r\n\r\n    get(type: EntityTypeEnum) {\r\n        if (!this.ObjectPool) {\r\n            this.ObjectPool = new Node(\"ObjectPool\")\r\n            this.ObjectPool.setParent(DataManager.Instance.stage)\r\n        }\r\n        if (!this.map.has(type)) {\r\n            this.map.set(type, [])\r\n            const container = new Node(type + 'Pool')\r\n            container.setParent(this.ObjectPool)\r\n        }\r\n        const nodes = this.map.get(type)\r\n        if (!nodes.length) {\r\n            const prefab = DataManager.Instance.prefabMap.get(type)\r\n            const node = instantiate(prefab)\r\n            node.name = type;\r\n            node.active = true\r\n            node.setParent(this.ObjectPool.getChildByName(type + 'Pool'))\r\n            return node\r\n        } else {\r\n            const node = nodes.pop()\r\n            node.active = true\r\n            return node\r\n        }\r\n\r\n    }\r\n    ret(node: Node) {\r\n        node.active = false;\r\n        this.map.get(node.name as EntityTypeEnum).push(node)\r\n    }\r\n}\r\n"]}