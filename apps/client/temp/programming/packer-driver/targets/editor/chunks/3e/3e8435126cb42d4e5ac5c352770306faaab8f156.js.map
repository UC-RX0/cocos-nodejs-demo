{"version":3,"sources":["file:///D:/CocosProject/cocos-nodejs-io-game-start-demo-master/apps/client/assets/Scripts/UI/JoyStickManager.ts"],"names":["_decorator","Component","input","Input","UITransform","Vec2","Vec3","ccclass","property","JoyStickManager","Body","Stick","radius","defaultPos","ZERO","_input","value","onLoad","node","getChildByName","getComponent","width","getPosition","on","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","onDestroy","off","event","setPosition","getLocationX","getLocationY","offsetV2","x","y","len","length","multiplyScalar","clone","normalize"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, input, Input, Node, UITransform, Vec2, Vec3 } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n/**\r\n * 这是负责摇杆的设置 并且向外界暴露一个input输出值V2 以移动人物位置\r\n * 包括touchStart 要获取屏幕当前的位置 确定当前摇杆的位置，随手指移动的随动摇杆\r\n * TouchMove 要获取当前移动的位置 计算偏移量 显示摇杆移动 并且要限制摇杆在半径内移动\r\n * TouchEnd 要恢复摇杆的位置至00位置\r\n */\r\n@ccclass('JoyStickManager')\r\nexport class JoyStickManager extends Component {\r\n    private Body: Node | null = null;\r\n    private Stick: Node | null = null;\r\n    private radius: number =0;\r\n    private defaultPos = Vec3.ZERO;\r\n    private _input: Vec2 = Vec2.ZERO; //对外输出的输入向量\r\n    public get input(): Vec2 {\r\n        return this._input;\r\n    }\r\n    public set input(value: Vec2) {\r\n        this._input = value;\r\n    }\r\n    onLoad () {\r\n        this.Body = this.node?.getChildByName('Body');\r\n        this.Stick = this.Body?.getChildByName('Stick');\r\n        this.radius = this.Body!.getComponent(UITransform).width / 2;//!.断言 说是一定有这个值\r\n        this.defaultPos = this.Body!.getPosition();\r\n        input.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        input.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        input.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\r\n    }\r\n\r\n    onDestroy () {\r\n        input.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        input.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        input.off(Input.EventType.TOUCH_END, this.onTouchEnd, this);\r\n    }\r\n\r\n    onTouchStart(event: EventTouch) {\r\n        // console.log(event.getLocation()); \r\n        this.Body?.setPosition(event.getLocationX(), event.getLocationY(), 0);\r\n        // console.log(event.getUILocation());  // Location on UI space\r\n        \r\n    }\r\n    onTouchMove(event: EventTouch) {\r\n        const offsetV2:Vec2 = new Vec2(event.getLocationX() - this.Body!.getPosition().x, event.getLocationY() - this.Body!.getPosition().y);\r\n        const len = offsetV2.length();\r\n        if (len > this.radius) {\r\n            offsetV2.multiplyScalar(this.radius / len);\r\n        }\r\n        this.Stick?.setPosition(offsetV2.x, offsetV2.y, 0);//计算偏移量 这样小圆圈就能有随动的效果\r\n        this.input = offsetV2.clone().normalize();//对外输出的input是一个单位向量\r\n    }\r\n    onTouchEnd(event: EventTouch) {\r\n        this.Stick?.setPosition(0, 0, 0);\r\n        this.Body?.setPosition(this.defaultPos);\r\n        this.input = Vec2.ZERO;\r\n    }\r\n}\r\n\r\n\r\n"]}