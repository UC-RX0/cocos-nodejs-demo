{"version":3,"sources":["file:///D:/CocosProject/cocos-nodejs-io-game-start-demo-master/apps/client/extensions/Behavior%20Eden/src/runtime/node/composite/Parallel.ts"],"names":["Composite","NodeStatus","btclass","Parallel","executionStatus","onStart","index","children","map","Inactive","canRunParallelChildren","onChildStarted","Running","canExecute","length","onChildExecuted","status","overrideStatus","_","childrenComplete","i","Failure","Success","onConditionalAbort","childIndex"],"mappings":";;;;;;;;;AAASA,MAAAA,S,gBAAAA,S;AAAWC,MAAAA,U,gBAAAA,U;;AACXC,MAAAA,O,iBAAAA,O;;;;;yBAGYC,Q,WADpBD,OAAO,CAAC,UAAD,C,gBAAR,MACqBC,QADrB,SACsCH,SADtC,CACgD;AAAA;AAAA;AAAA,eAC9CI,eAD8C,GACT,EADS;AAAA;;AAG9CC,QAAAA,OAAO,GAAS;AACd,gBAAMA,OAAN;AACA,eAAKC,KAAL,GAAa,CAAb;AACA,eAAKF,eAAL,GAAuB,KAAKG,QAAL,CAAcC,GAAd,CAAkB,MAAMP,UAAU,CAACQ,QAAnC,CAAvB;AACD;;AAEDC,QAAAA,sBAAsB,GAAG;AACvB,iBAAO,IAAP;AACD;;AAEDC,QAAAA,cAAc,GAAG;AACf,eAAKP,eAAL,CAAqB,KAAKE,KAA1B,IAAmCL,UAAU,CAACW,OAA9C;AACA,eAAKN,KAAL;AACD;;AAEDO,QAAAA,UAAU,GAAY;AACpB,iBAAO,KAAKP,KAAL,GAAa,KAAKC,QAAL,CAAcO,MAAlC;AACD;;AAEDC,QAAAA,eAAe,CAACC,MAAD,EAAqBV,KAArB,EAA0C;AACvD,eAAKF,eAAL,CAAqBE,KAArB,IAA8BU,MAA9B;AACD;;AAEDC,QAAAA,cAAc,CAACC,CAAD,EAAgB;AAC5B,cAAIC,gBAAgB,GAAG,IAAvB;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKhB,eAAL,CAAqBU,MAAzC,EAAiDM,CAAC,EAAlD,EAAsD;AACpD,gBAAI,KAAKhB,eAAL,CAAqBgB,CAArB,KAA2BnB,UAAU,CAACW,OAA1C,EAAmD;AACjDO,cAAAA,gBAAgB,GAAG,KAAnB;AACD,aAFD,MAEO,IAAI,KAAKf,eAAL,CAAqBgB,CAArB,KAA2BnB,UAAU,CAACoB,OAA1C,EAAmD;AACxD,qBAAOpB,UAAU,CAACoB,OAAlB;AACD;AACF;;AACD,iBAAOF,gBAAgB,GAAGlB,UAAU,CAACqB,OAAd,GAAwBrB,UAAU,CAACW,OAA1D;AACD;;AAEDW,QAAAA,kBAAkB,CAACC,UAAD,EAA2B;AAC3C,eAAKlB,KAAL,GAAa,CAAb;AACA,eAAKF,eAAL,GAAuB,KAAKA,eAAL,CAAqBI,GAArB,CAAyB,MAAMP,UAAU,CAACQ,QAA1C,CAAvB;AACD;;AAzC6C,O","sourcesContent":["import { Composite, NodeStatus } from \"../index\";\r\nimport { btclass } from \"../../core/decorator\";\r\n\r\n@btclass(\"Parallel\")\r\nexport default class Parallel extends Composite {\r\n  executionStatus: Array<NodeStatus> = [];\r\n\r\n  onStart(): void {\r\n    super.onStart();\r\n    this.index = 0;\r\n    this.executionStatus = this.children.map(() => NodeStatus.Inactive);\r\n  }\r\n\r\n  canRunParallelChildren() {\r\n    return true;\r\n  }\r\n\r\n  onChildStarted() {\r\n    this.executionStatus[this.index] = NodeStatus.Running;\r\n    this.index++;\r\n  }\r\n\r\n  canExecute(): boolean {\r\n    return this.index < this.children.length;\r\n  }\r\n\r\n  onChildExecuted(status: NodeStatus, index: number): void {\r\n    this.executionStatus[index] = status;\r\n  }\r\n\r\n  overrideStatus(_: NodeStatus) {\r\n    let childrenComplete = true;\r\n    for (let i = 0; i < this.executionStatus.length; i++) {\r\n      if (this.executionStatus[i] == NodeStatus.Running) {\r\n        childrenComplete = false;\r\n      } else if (this.executionStatus[i] == NodeStatus.Failure) {\r\n        return NodeStatus.Failure;\r\n      }\r\n    }\r\n    return childrenComplete ? NodeStatus.Success : NodeStatus.Running;\r\n  }\r\n\r\n  onConditionalAbort(childIndex: number): void {\r\n    this.index = 0;\r\n    this.executionStatus = this.executionStatus.map(() => NodeStatus.Inactive);\r\n  }\r\n}\r\n"]}