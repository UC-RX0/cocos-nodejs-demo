{"version":3,"sources":["file:///D:/CocosProject/cocos-nodejs-io-game-start-demo-master/apps/client/extensions/Behavior%20Eden/src/runtime/core/BehaviorManager.ts"],"names":["BehaviorTree","ConditionalReevaluate","_decorator","Component","director","AbortType","Composite","Condition","Decorator","NodeStatus","ParentNode","BehaviorTreeEvent","bfsCcNode","ccclass","BehaviorManager","behaviorTrees","behaviorTreesMap","Map","pausedBehaviorTreesMap","restart","behaviorTree","behavior","logNodeChange","console","log","removeChildConditionalReevaluate","pushNode","onLoad","instance","onDestroy","disableBehavior","isPause","get","set","status","Inactive","Success","i","activeStack","length","curStack","j","popNode","emit","BehaviorTreeEnd","delete","index","findIndex","tree","splice","enableBehavior","rootNode","behaviorSource","warn","has","push","parentIndex","relativeChildIndex","parentCompositeIndex","addToNodeList","BehaviorTreeStart","Running","node","data","nodeList","childrenIndex","childConditionalIndex","children","update","tick","reevaluateConditionalNode","prevIndex","prevStatus","curIndex","runNode","stackIndex","runParentNode","overrideStatus","res1","onUpdate","done","res2","emitEvent","canRunParallelChildren","childStatus","preIndex","canExecute","childIndex","onChildStarted","stack","onStart","popChildren","pop","onEnd","composite","abortType","None","compositeIndex","LowerPriority","conditionalReevaluateMap","conditionalReevaluate","parentNode","onChildExecuted","decorate","Self","includes","Both","isParentNode","Failure","restartWhenComplete","curNodeIndex","commonParentIndex","findCommonParentIndex","stackLen","compositeNode","conditionalParentIndex","m","n","parentTask","onConditionalAbort","index1","index2","Set","num","add","possibleParent","possibleChild","nodeData","lifeCycle","dump","event","nodeUuid","compUuid","comp","methodName","method","methodData","curNode","target","getScene","uuid","_components","find","res","call","result","undefined","root","constructor"],"mappings":"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","sourcesContent":["import { _decorator, Component, director } from \"cc\";\r\nimport { AbortType, Composite, Condition, Decorator, Node, NodeData, NodeStatus, ParentNode } from \"../node\";\r\nimport { BehaviorTree as Behavior, BehaviorTreeEvent } from \"./BehaviorTree\";\r\nimport { bfsCcNode } from \"./utils\";\r\n\r\nconst { ccclass } = _decorator;\r\n\r\n/***\r\n * 该组件会自动添加到场景上，用来驱动、管理场景中所有行为树\r\n */\r\n@ccclass(\"BehaviorManager\")\r\nexport class BehaviorManager extends Component {\r\n  static instance: BehaviorManager | null = null;\r\n\r\n  behaviorTrees: BehaviorTree[] = [];\r\n  // behavior是用户使用的组件，BehaviorTree是真正的行为树数据结构\r\n  behaviorTreesMap: Map<Behavior, BehaviorTree> = new Map();\r\n  // 存储被暂停运行的行为树\r\n  pausedBehaviorTreesMap: Map<Behavior, BehaviorTree> = new Map();\r\n\r\n  restart(behaviorTree: BehaviorTree) {\r\n    if (behaviorTree.behavior.logNodeChange) {\r\n      console.log(\"restart\", behaviorTree);\r\n    }\r\n    // 所有节点都popNode出去以后，未删除的条件重评估的compositeIndex都为-1\r\n    this.removeChildConditionalReevaluate(behaviorTree, -1);\r\n    this.pushNode(behaviorTree, 0, 0);\r\n  }\r\n\r\n  // 防止用户手动创建实例但没有设置instance\r\n  onLoad() {\r\n    BehaviorManager.instance = this;\r\n  }\r\n\r\n  onDestroy() {\r\n    for (const behaviorTree of this.behaviorTrees) {\r\n      this.disableBehavior(behaviorTree.behavior);\r\n    }\r\n  }\r\n\r\n  /***\r\n   * 不传isPause的话，默认删掉行为树\r\n   */\r\n  disableBehavior(behavior: Behavior, isPause = false) {\r\n    const behaviorTree = this.behaviorTreesMap.get(behavior);\r\n    if (!behaviorTree) {\r\n      return;\r\n    }\r\n\r\n    if (isPause) {\r\n      // 存进暂停map里\r\n      this.pausedBehaviorTreesMap.set(behavior, behaviorTree);\r\n      behaviorTree.behavior.status = NodeStatus.Inactive; //设置为未激活状态\r\n    } else {\r\n      // 如果是手动disabled的话，让剩下的节点popNode，并不断迭代这个状态作为最终行为树的状态\r\n      let status = NodeStatus.Success;\r\n      for (let i = behaviorTree.activeStack.length - 1; i >= 0; i--) {\r\n        const curStack = behaviorTree.activeStack[i];\r\n        for (let j = curStack.length - 1; j >= 0; j--) {\r\n          status = this.popNode(behaviorTree, curStack[curStack.length - 1], i, status, false);\r\n        }\r\n      }\r\n      behavior.status = status;\r\n      this.removeChildConditionalReevaluate(behaviorTree, -1);\r\n      behavior.emit(BehaviorTreeEvent.BehaviorTreeEnd);\r\n      this.behaviorTreesMap.delete(behavior);\r\n    }\r\n    const index = this.behaviorTrees.findIndex((tree) => tree === behaviorTree);\r\n    // 数组删除该树\r\n    index > -1 && this.behaviorTrees.splice(index, 1);\r\n  }\r\n\r\n  public enableBehavior(behavior: Behavior) {\r\n    const rootNode = behavior.behaviorSource.rootNode;\r\n    if (!rootNode) {\r\n      if (behavior.logNodeChange) {\r\n        console.warn(\"该行为树没有根节点\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    // 仅被暂停的树，从map里拿出来继续运行\r\n    if (this.pausedBehaviorTreesMap.has(behavior)) {\r\n      const behaviorTree = this.pausedBehaviorTreesMap.get(behavior)!;\r\n      this.pausedBehaviorTreesMap.delete(behavior);\r\n      this.behaviorTrees.push(behaviorTree);\r\n      this.behaviorTreesMap.set(behavior, behaviorTree);\r\n      return;\r\n    }\r\n\r\n    // 全新的树\r\n    const behaviorTree = new BehaviorTree();\r\n    behaviorTree.behavior = behavior;\r\n    this.behaviorTrees.push(behaviorTree);\r\n    this.behaviorTreesMap.set(behavior, behaviorTree);\r\n    //填充数据结构\r\n    behaviorTree.activeStack.push([]);\r\n    behaviorTree.parentIndex.push(-1);\r\n    behaviorTree.relativeChildIndex.push(-1);\r\n    behaviorTree.parentCompositeIndex.push(-1);\r\n    this.addToNodeList(behaviorTree, rootNode, { parentCompositeIndex: -1 });\r\n    //根节点放入运行栈\r\n    behaviorTree.behavior.emit(BehaviorTreeEvent.BehaviorTreeStart);\r\n    behaviorTree.behavior.status = NodeStatus.Running;\r\n    //根节点放入运行栈\r\n    this.pushNode(behaviorTree, 0, 0);\r\n  }\r\n\r\n  // 数据结构填充\r\n  addToNodeList(behaviorTree: BehaviorTree, node: Node, data: { parentCompositeIndex: number }) {\r\n    behaviorTree.nodeList.push(node);\r\n    const index = behaviorTree.nodeList.length - 1;\r\n    if (node instanceof ParentNode) {\r\n      behaviorTree.childrenIndex.push([]);\r\n      behaviorTree.childConditionalIndex.push([]);\r\n      for (let i = 0; i < node.children.length; i++) {\r\n        behaviorTree.parentIndex.push(index);\r\n        behaviorTree.relativeChildIndex.push(i);\r\n        behaviorTree.childrenIndex[index].push(behaviorTree.nodeList.length);\r\n        if (node instanceof Composite) {\r\n          data.parentCompositeIndex = index;\r\n        }\r\n        behaviorTree.parentCompositeIndex.push(data.parentCompositeIndex);\r\n        this.addToNodeList(behaviorTree, node.children[i], data);\r\n      }\r\n    } else {\r\n      behaviorTree.childrenIndex.push(null as any);\r\n      behaviorTree.childConditionalIndex.push(null as any);\r\n      if (node instanceof Condition) {\r\n        const parentCompositeIndex = behaviorTree.parentCompositeIndex[index];\r\n        if (parentCompositeIndex !== -1) {\r\n          behaviorTree.childConditionalIndex[parentCompositeIndex].push(index);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.tick();\r\n  }\r\n\r\n  /***\r\n   * 驱动所有行为树\r\n   */\r\n  tick() {\r\n    //遍历所有树\r\n    for (const behaviorTree of this.behaviorTrees) {\r\n      if (behaviorTree.behavior.logNodeChange) {\r\n        console.log(\"tick\", behaviorTree);\r\n      }\r\n      // 重评估条件\r\n      this.reevaluateConditionalNode(behaviorTree);\r\n      //遍历所有运行栈\r\n      //\r\n      for (let i = behaviorTree.activeStack.length - 1; i >= 0; i--) {\r\n        const curStack = behaviorTree.activeStack[i];\r\n        let prevIndex = -1;\r\n        let prevStatus = NodeStatus.Inactive;\r\n\r\n        while (prevStatus !== NodeStatus.Running && i < behaviorTree.activeStack.length && curStack.length) {\r\n          const curIndex = curStack[curStack.length - 1];\r\n          // 记录前后两次，防止repeater子节点状态为success时，在一个tick里重复运行\r\n          if (curIndex === prevIndex) {\r\n            break;\r\n          }\r\n          prevIndex = curIndex;\r\n          // runNode需要传入prevStatus的原因是\r\n          // 例如selector一个子节点是running状态，某个tick变成了success状态，子节点popNode出去\r\n          // 下一个tick进来，栈顶元素是selector，此时canExecute为false，runParentNode没办法返回一个具体的状态\r\n          // 此时就可以把上一个tick子节点的状态作为本次tick的selector的状态（反转节点同理）\r\n          prevStatus = this.runNode(behaviorTree, curIndex, i, prevStatus);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  runNode(behaviorTree: BehaviorTree, index: number, stackIndex: number, prevStatus: NodeStatus) {\r\n    const node = behaviorTree.nodeList[index];\r\n    // 保证运行的节点在栈顶\r\n    this.pushNode(behaviorTree, index, stackIndex);\r\n    let status = prevStatus;\r\n    if (node instanceof ParentNode) {\r\n      status = this.runParentNode(behaviorTree, index, stackIndex, status);\r\n      // 并行节点的状态不由某个子节点状态决定，而是由多个共同决定，所以重新计算status\r\n      status = node.overrideStatus(status);\r\n    } else {\r\n      // 执行目标事件\r\n      const res1 = node.onUpdate();\r\n      const [done, res2] = this.emitEvent(behaviorTree, node.data, \"onUpdate\");\r\n      status = done ? res2 : res1;\r\n    }\r\n\r\n    // 非running的节点pop出去\r\n    if (status !== NodeStatus.Running) {\r\n      status = this.popNode(behaviorTree, index, stackIndex, status);\r\n    }\r\n\r\n    return status;\r\n  }\r\n\r\n  runParentNode(behaviorTree: BehaviorTree, index: number, stackIndex: number, status: NodeStatus) {\r\n    const node = behaviorTree.nodeList[index] as ParentNode;\r\n    //防止running状态的并行节点重复运行\r\n    if (node.canRunParallelChildren() && node.overrideStatus(NodeStatus.Running) === NodeStatus.Running) {\r\n      return status;\r\n    }\r\n\r\n    let childStatus = NodeStatus.Inactive;\r\n    let preIndex = -1;\r\n    //并行节点可以存在多个running状态的子节点\r\n    while (node.canExecute() && (childStatus !== NodeStatus.Running || node.canRunParallelChildren())) {\r\n      const childIndex = node.index;\r\n      // 并行节点创建新的运行栈\r\n      if (node.canRunParallelChildren()) {\r\n        behaviorTree.activeStack.push([]);\r\n        stackIndex = behaviorTree.activeStack.length - 1;\r\n        node.onChildStarted();\r\n      }\r\n\r\n      let curIndex = childIndex;\r\n      // 防止repeater或untilSuccess等可以重复运行的节点，canExecute一直是true，会导致一直进入while\r\n      // 所以加入curIndex和preIndex，保证不能在一次runParentNode里重复运行相同节点\r\n      if (curIndex === preIndex) {\r\n        status = NodeStatus.Running;\r\n        break;\r\n      }\r\n      preIndex = curIndex;\r\n      status = childStatus = this.runNode(\r\n        behaviorTree,\r\n        behaviorTree.childrenIndex[index][childIndex],\r\n        stackIndex,\r\n        status\r\n      );\r\n    }\r\n\r\n    // 子节点有运行就返回子节点的状态，没有就返回上一次运行的状态\r\n    return status;\r\n  }\r\n\r\n  pushNode(behaviorTree: BehaviorTree, index: number, stackIndex: number) {\r\n    const stack = behaviorTree.activeStack[stackIndex];\r\n    // 防止重复推入\r\n    if (stack.length === 0 || stack[stack.length - 1] !== index) {\r\n      stack.push(index);\r\n      const node = behaviorTree.nodeList[index];\r\n      if (behaviorTree.behavior.logNodeChange) {\r\n        console.log(\"pushNode\", node, \"index:\", index, \"stackIndex:\", stackIndex);\r\n      }\r\n      node.onStart();\r\n      this.emitEvent(behaviorTree, node.data, \"onStart\");\r\n    }\r\n  }\r\n\r\n  popNode(behaviorTree: BehaviorTree, index: number, stackIndex: number, status: NodeStatus, popChildren = true) {\r\n    const curStack = behaviorTree.activeStack[stackIndex];\r\n    curStack.pop();\r\n    const node = behaviorTree.nodeList[index];\r\n    node.onEnd();\r\n    this.emitEvent(behaviorTree, node.data, \"onEnd\");\r\n    if (behaviorTree.behavior.logNodeChange) {\r\n      console.log(\"popNode\", node, \"index:\", index, \"stackIndex:\", stackIndex, \"status:\", status);\r\n    }\r\n    const parentIndex = behaviorTree.parentIndex[index];\r\n    if (parentIndex !== -1) {\r\n      if (node instanceof Condition) {\r\n        const parentCompositeIndex = behaviorTree.parentCompositeIndex[index];\r\n        if (parentCompositeIndex !== -1) {\r\n          const composite = behaviorTree.nodeList[parentCompositeIndex] as Composite;\r\n          //自己是条件节点并且父级的中断类型存在，创建重判断实例\r\n          if (composite.abortType !== AbortType.None) {\r\n            // 父composite为LowerPriority时，条件重评估不希望此时执行，而是父composite popNode出去再执行\r\n            const compositeIndex = composite.abortType === AbortType.LowerPriority ? -1 : parentCompositeIndex;\r\n            // 防止该条件存在条件重评估对象\r\n            if (behaviorTree.conditionalReevaluateMap.has(index)) {\r\n              const conditionalReevaluate = behaviorTree.conditionalReevaluateMap.get(index)!;\r\n              conditionalReevaluate.compositeIndex = compositeIndex;\r\n              conditionalReevaluate.status = status;\r\n            } else {\r\n              const conditionalReevaluate = new ConditionalReevaluate(index, stackIndex, status, compositeIndex);\r\n              if (behaviorTree.behavior.logNodeChange) {\r\n                console.log(\r\n                  \"new ConditionalReevaluate\",\r\n                  conditionalReevaluate,\r\n                  \"index:\",\r\n                  index,\r\n                  \"stackIndex:\",\r\n                  stackIndex,\r\n                  \"compositeIndex\",\r\n                  compositeIndex\r\n                );\r\n              }\r\n              behaviorTree.conditionalReevaluate.push(conditionalReevaluate);\r\n              behaviorTree.conditionalReevaluateMap.set(index, conditionalReevaluate);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      const parentNode = behaviorTree.nodeList[parentIndex] as ParentNode;\r\n      parentNode.onChildExecuted(status, behaviorTree.relativeChildIndex[index]);\r\n      // 父节点是反转节点，修改结果\r\n      if (parentNode instanceof Decorator) {\r\n        status = parentNode.decorate(status);\r\n      }\r\n    }\r\n\r\n    if (node instanceof Composite) {\r\n      // 类型是Self或者None时，清空所有子条件重评估，或者popNode的节点是当前运行栈的最后一项，删除该节点管理的条件重评估\r\n      if ([AbortType.Self, AbortType.None].includes(node.abortType) || !curStack.length) {\r\n        this.removeChildConditionalReevaluate(behaviorTree, index);\r\n        // 类型是LowerPriority或者Both，上移compositeIndex，compositeIndex为-1的条件重评估对象，LowerPriority，会因此激活\r\n      } else if ([AbortType.LowerPriority, AbortType.Both].includes(node.abortType)) {\r\n        for (let i = 0; i < behaviorTree.childConditionalIndex[index].length; i++) {\r\n          const childConditionalIndex = behaviorTree.childConditionalIndex[index][i];\r\n          if (behaviorTree.conditionalReevaluateMap.has(childConditionalIndex)) {\r\n            const conditionalReevaluate = behaviorTree.conditionalReevaluateMap.get(childConditionalIndex)!;\r\n            conditionalReevaluate.compositeIndex = behaviorTree.parentCompositeIndex[index];\r\n          }\r\n        }\r\n\r\n        // 上移当前被移除的composite管理的所有条件重评估的compositeIndex\r\n        for (let i = 0; i < behaviorTree.conditionalReevaluate.length; i++) {\r\n          const conditionalReevaluate = behaviorTree.conditionalReevaluate[i];\r\n          if (conditionalReevaluate.compositeIndex === index) {\r\n            conditionalReevaluate.compositeIndex = behaviorTree.parentCompositeIndex[index];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (popChildren) {\r\n      //并行节点删除其他正在运行的子节点\r\n      for (let i = behaviorTree.activeStack.length - 1; i > stackIndex; i--) {\r\n        const stack = behaviorTree.activeStack[i];\r\n        if (stack.length > 0 && this.isParentNode(behaviorTree, index, stack[stack.length - 1])) {\r\n          let status = NodeStatus.Failure;\r\n          for (let j = stack.length - 1; j >= 0; j--) {\r\n            status = this.popNode(behaviorTree, stack[stack.length - 1], i, status, false);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // 当前运行栈没有节点了\r\n    if (curStack.length === 0) {\r\n      // 当前运行栈就是主运行栈\r\n      if (stackIndex === 0) {\r\n        // 重启行为树\r\n        if (behaviorTree.behavior.restartWhenComplete) {\r\n          this.restart(behaviorTree);\r\n        } else {\r\n          this.disableBehavior(behaviorTree.behavior);\r\n          //修改disableBehavior写入的status\r\n          behaviorTree.behavior.status = status;\r\n        }\r\n        status = NodeStatus.Inactive;\r\n      } else {\r\n        // 删除其他空子运行栈\r\n        behaviorTree.activeStack.splice(stackIndex, 1);\r\n        // 返回running，退出tick的while循环\r\n        status = NodeStatus.Running;\r\n      }\r\n    }\r\n\r\n    return status;\r\n  }\r\n\r\n  reevaluateConditionalNode(behaviorTree: BehaviorTree) {\r\n    if (behaviorTree.behavior.logNodeChange) {\r\n      console.log(\"reevaluateConditionalNode start\", behaviorTree.conditionalReevaluate);\r\n    }\r\n    for (let i = behaviorTree.conditionalReevaluate.length - 1; i >= 0; i--) {\r\n      const { index, compositeIndex, status: prevStatus } = behaviorTree.conditionalReevaluate[i];\r\n      //父组合节点索引不存在或者故意设置为-1，不进行评估\r\n      if (compositeIndex === -1) {\r\n        continue;\r\n      }\r\n\r\n      const node = behaviorTree.nodeList[index];\r\n      let status = NodeStatus.Inactive;\r\n      const res1 = node.onUpdate();\r\n      const [done, res2] = this.emitEvent(behaviorTree, node.data, \"onUpdate\");\r\n      status = done ? res2 : res1;\r\n\r\n      //条件一致\r\n      if (status === prevStatus) {\r\n        continue;\r\n      }\r\n\r\n      if (behaviorTree.behavior.logNodeChange) {\r\n        console.log(\"reevaluateConditionalNode success\", behaviorTree.conditionalReevaluate[i]);\r\n      }\r\n\r\n      for (let j = behaviorTree.activeStack.length - 1; j >= 0; j--) {\r\n        const stack = behaviorTree.activeStack[j];\r\n        if (!stack.length) {\r\n          continue;\r\n        }\r\n\r\n        //当前节点及他到公共父节点之间所有父节点pop出去\r\n        let curNodeIndex = stack[stack.length - 1];\r\n        const commonParentIndex = this.findCommonParentIndex(behaviorTree, curNodeIndex, index);\r\n        // 该条件重评估的compositeIndex是commonParent的父级\r\n        if (this.isParentNode(behaviorTree, compositeIndex, commonParentIndex)) {\r\n          // popNode可能会修改activeStack，保存一下长度，相同才执行\r\n          const stackLen = behaviorTree.activeStack.length;\r\n          while (\r\n            curNodeIndex !== -1 &&\r\n            curNodeIndex !== commonParentIndex &&\r\n            behaviorTree.activeStack.length === stackLen\r\n          ) {\r\n            this.popNode(behaviorTree, curNodeIndex, j, NodeStatus.Failure, false);\r\n            curNodeIndex = behaviorTree.parentIndex[curNodeIndex];\r\n          }\r\n        }\r\n      }\r\n\r\n      //右边的包括自己的重评估条件删除掉\r\n      for (let j = behaviorTree.conditionalReevaluate.length - 1; j >= i; j--) {\r\n        const conditionalReevaluate = behaviorTree.conditionalReevaluate[j];\r\n        if (this.isParentNode(behaviorTree, compositeIndex, conditionalReevaluate.index)) {\r\n          behaviorTree.conditionalReevaluateMap.delete(conditionalReevaluate.index);\r\n          behaviorTree.conditionalReevaluate.splice(j, 1);\r\n        }\r\n      }\r\n\r\n      const compositeNode = behaviorTree.nodeList[behaviorTree.parentCompositeIndex[index]] as Composite;\r\n      // 遍历左侧的条件重评估对象\r\n      for (let j = i - 1; j >= 0; j--) {\r\n        const conditionalReevaluate = behaviorTree.conditionalReevaluate[j];\r\n        if (\r\n          behaviorTree.parentCompositeIndex[conditionalReevaluate.index] === behaviorTree.parentCompositeIndex[index]\r\n        ) {\r\n          // composite节点是LowerPriority，则让这些条件停止运行\r\n          if (compositeNode.abortType === AbortType.LowerPriority) {\r\n            conditionalReevaluate.compositeIndex = -1;\r\n            // composite节点是Both或者Self，条件重评估的compositeIndex等于parentCompositeIndex\r\n          } else if ([AbortType.Both, AbortType.Self].includes(compositeNode.abortType)) {\r\n            conditionalReevaluate.index = behaviorTree.parentCompositeIndex[index];\r\n          }\r\n        }\r\n      }\r\n\r\n      //当前条件节点到CommonParentNode之间所有Composite节点执行onConditionalAbort\r\n      const conditionalParentIndex = [];\r\n      for (let m = behaviorTree.parentIndex[index]; m != compositeIndex; m = behaviorTree.parentIndex[m]) {\r\n        conditionalParentIndex.push(m);\r\n      }\r\n      conditionalParentIndex.push(compositeIndex);\r\n      //从顶部到底部的顺序执行\r\n      for (let n = conditionalParentIndex.length - 1; n >= 0; n--) {\r\n        const parentTask = behaviorTree.nodeList[conditionalParentIndex[n]] as ParentNode;\r\n        if (n === 0) {\r\n          parentTask.onConditionalAbort(behaviorTree.relativeChildIndex[index]);\r\n        } else {\r\n          parentTask.onConditionalAbort(behaviorTree.relativeChildIndex[conditionalParentIndex[n - 1]]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  removeChildConditionalReevaluate(behaviorTree: BehaviorTree, compositeIndex: number) {\r\n    for (let i = behaviorTree.conditionalReevaluate.length - 1; i >= 0; i--) {\r\n      if (behaviorTree.conditionalReevaluate[i].compositeIndex === compositeIndex) {\r\n        behaviorTree.conditionalReevaluateMap.delete(behaviorTree.conditionalReevaluate[i].index);\r\n        behaviorTree.conditionalReevaluate.splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  findCommonParentIndex(behaviorTree: BehaviorTree, index1: number, index2: number) {\r\n    const set = new Set();\r\n    let num = index1;\r\n    while (num !== -1) {\r\n      set.add(num);\r\n      num = behaviorTree.parentIndex[num];\r\n    }\r\n\r\n    num = index2;\r\n    while (!set.has(num)) {\r\n      num = behaviorTree.parentIndex[num];\r\n    }\r\n\r\n    return num;\r\n  }\r\n\r\n  isParentNode(behaviorTree: BehaviorTree, possibleParent: number, possibleChild: number) {\r\n    for (let num = possibleChild; num !== -1; num = behaviorTree.parentIndex[num]) {\r\n      if (num === possibleParent) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /***\r\n   * 执行节点事件\r\n   */\r\n  emitEvent(\r\n    behaviorTree: BehaviorTree,\r\n    nodeData: NodeData,\r\n    lifeCycle: keyof NodeData[\"event\"]\r\n  ): [false, null] | [true, NodeStatus] {\r\n    const dump: NodeData[\"event\"][\"onStart\"] = nodeData.event[lifeCycle];\r\n    const nodeUuid = dump.node;\r\n    const compUuid = dump.comp;\r\n    const methodName = dump.method;\r\n    const methodData = dump.data;\r\n    if (!nodeUuid || !compUuid || !methodName) {\r\n      return [false, null];\r\n    }\r\n\r\n    // 行为树组件所在cocos节点\r\n    const curNode = behaviorTree.behavior.node;\r\n    // 先从当前节点开始层序遍历\r\n    let target = bfsCcNode(curNode, nodeUuid);\r\n    // 找不到再从scene节点开始层序遍历\r\n    if (!target) {\r\n      target = bfsCcNode(director.getScene(), nodeUuid, curNode.uuid);\r\n    }\r\n    if (!target) {\r\n      return [false, null];\r\n    }\r\n\r\n    const comp = target._components.find((comp: any) => comp.uuid === compUuid);\r\n    if (!comp) {\r\n      return [false, null];\r\n    }\r\n\r\n    const method = comp[methodName];\r\n    if (!method) {\r\n      return [false, null];\r\n    }\r\n\r\n    const res = method.call(comp, methodData);\r\n    // 用户忘记写返回值，一律返回失败\r\n    const result = res !== undefined ? res : NodeStatus.Failure;\r\n    return [true, result];\r\n  }\r\n}\r\n\r\n/***\r\n * 行为树数据结构，具体执行逻辑由BehaviorManager驱动\r\n */\r\nclass BehaviorTree {\r\n  // @ts-ignore\r\n  root: BTTree;\r\n  // @ts-ignore\r\n  behavior: Behavior; //用户使用的BehaviorTree组件\r\n  activeStack: Array<Array<number>> = [];\r\n  nodeList: Array<Node> = [];\r\n  //当前节点的父节点\r\n  parentIndex: Array<number> = [];\r\n  //当前节点的子节点\r\n  childrenIndex: Array<Array<number>> = [];\r\n\r\n  /***\r\n   * 为了实现中断\r\n   */\r\n  //当前节点是父节点的第几个子节点\r\n  relativeChildIndex: Array<number> = [];\r\n  //当前节点的父组合节点\r\n  parentCompositeIndex: Array<number> = [];\r\n  //当前节点的子条件节点\r\n  childConditionalIndex: Array<Array<number>> = [];\r\n  //所有条件重评估\r\n  conditionalReevaluate: Array<ConditionalReevaluate> = [];\r\n  //条件重评估id的map\r\n  conditionalReevaluateMap: Map<number, ConditionalReevaluate> = new Map();\r\n}\r\n\r\n/***\r\n * 条件重评估数据结构\r\n * 各种情况讲解：\r\n * 1、LowerPriority：左侧的重评估条件可以打断右侧Action节点的运行，不过不是所有都能打断，当Action属于该compositeIndex所管理的子树才能打断\r\n *  因此，随着compositeIndex逐渐上移，该条件能打断的范围就会越大，当然这就需要此条件的父节点均有LowerPriority或者Both，才能让compositeIndex一直上移\r\n * 2、Self：只能打断跟自己同一Composite节点下的其他节点的运行，当该Composite被popNode时，条件也会被删除\r\n * 3、Parallel：Parallel下有多个分支都有LowerPriority的条件重评估对象：\r\n *    情况1、假设某个分支返回Running状态，此时这个分支下的compositeIndex未达到并行节点，无法管理其他分支下Action运行\r\n *    情况2：返回Success或者Failure状态，当该运行栈最后一个元素popNode出去时，此时栈为空，会删除其管理的条件重评估\r\n *          如果该条件的compositeIndex是-1，不会进入compositeIndex上移逻辑，因此也无法运行\r\n *    总结：某个并行节点下的多个并行分支，各自的条件不会干扰\r\n */\r\nclass ConditionalReevaluate {\r\n  constructor(\r\n    public index: number,\r\n    public stackIndex: number,\r\n    public status: NodeStatus,\r\n    public compositeIndex: number\r\n  ) {}\r\n}\r\n"]}