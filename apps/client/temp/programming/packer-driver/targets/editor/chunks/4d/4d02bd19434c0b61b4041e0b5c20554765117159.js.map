{"version":3,"sources":["file:///D:/CocosProject/cocos-nodejs-io-game-start-demo-master/apps/client/assets/Scripts/Controller/BattleController.ts"],"names":["BattleController","Prefab","SpriteFrame","DataManager","ResourceManager","EntityTypeEnum","PrefabPathEnum","TexturePathEnum","setJoyStickData","joyStickData","Instance","jm","renderActor","data","state","actor","id","Type","actorMap","get","actorPrefab","prefabMap","render","prefab","renderBullet","bullets","bulletType","bullet","bulletMap","bulletPrefab","initMap","mapPrefab","Map","console","error","Error","loadRes","list","type","p","then","res","setprefabMap","push","loadDir","setTextureMap","setActorManager","setBulletManager"],"mappings":"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","sourcesContent":["import { Prefab, SpriteFrame } from \"cc\";\r\nimport DataManager from \"../Global/DataManager\";\r\nimport { ResourceManager } from \"../Global/ResourceManager\";\r\nimport { JoyStickManager } from \"../UI/JoyStickManager\";\r\nimport { ActorManager } from \"../Entity/Actor/ActorManager\";\r\nimport { EntityTypeEnum, IActor, IBullet } from \"../Common\";\r\nimport { PrefabPathEnum, TexturePathEnum } from \"../Enum\";\r\nimport { BulletManager } from \"../Entity/Bullet/BulletManager\";\r\n\r\n\r\n\r\nexport interface renderActorData {\r\n    data: IActor;\r\n    prefab: Prefab;\r\n}\r\nexport interface renderBulletData {\r\n    data: IBullet;\r\n    prefab: Prefab;\r\n}\r\n\r\nexport class BattleController {\r\n    static setJoyStickData(joyStickData: JoyStickManager) {\r\n        DataManager.Instance.jm = joyStickData;\r\n    }\r\n    static renderActor(): renderActorData {\r\n        for (const data of DataManager.Instance.state.actor) {\r\n            const { id, Type } = data;\r\n            const actor = DataManager.Instance.actorMap.get(id);\r\n            if (!actor) {\r\n                const actorPrefab = DataManager.Instance.prefabMap.get(Type);\r\n                if (actorPrefab) {\r\n                    const render: renderActorData = {\r\n                        data: data,\r\n                        prefab: actorPrefab\r\n                    }\r\n                    return render;\r\n                }\r\n            }\r\n            else {\r\n                actor.render(data);\r\n            }\r\n        }\r\n        return null\r\n    }\r\n\r\n    static renderBullet(): renderBulletData | null {\r\n        for (const data of DataManager.Instance.state.bullets) {\r\n            const { id, bulletType } = data;\r\n            const bullet = DataManager.Instance.bulletMap.get(id);\r\n            if (!bullet) {\r\n                const bulletPrefab = DataManager.Instance.prefabMap.get(bulletType);\r\n                if (bulletPrefab) {\r\n                    const render: renderBulletData = {\r\n                        data: data,\r\n                        prefab: bulletPrefab\r\n                    }\r\n                    return render;\r\n                }\r\n            }\r\n            else {\r\n                bullet.render(data);\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    static initMap(): Prefab {\r\n        //地图初始化\r\n        const mapPrefab = DataManager.Instance.prefabMap.get(EntityTypeEnum.Map);\r\n        if (!mapPrefab) {\r\n            console.error(\"Map prefab not found! EntityTypeEnum.Map:\", EntityTypeEnum.Map);\r\n            // 可以返回一个默认值或者抛出明确错误\r\n            throw new Error(`Map prefab not found for type: ${EntityTypeEnum.Map}`);\r\n        }\r\n        return mapPrefab;\r\n    }\r\n    //加载资源\r\n    static loadRes() {\r\n        const list = []\r\n        for (const type in EntityTypeEnum) {\r\n            const p = ResourceManager.Instance.loadRes(PrefabPathEnum[type], Prefab).then((res) => DataManager.Instance.setprefabMap(type, res));\r\n            list.push(p);\r\n        }\r\n        for (const type in TexturePathEnum) {\r\n            const p = ResourceManager.Instance.loadDir(TexturePathEnum[type], SpriteFrame).then((res) => DataManager.Instance.setTextureMap(type, res));\r\n            list.push(p);\r\n        }\r\n        return list\r\n    }\r\n    static setActorManager(id: number, actor: ActorManager) {\r\n        DataManager.Instance.setActorManager(id, actor);\r\n    }\r\n    static setBulletManager(id: number, bullet: BulletManager) {\r\n        DataManager.Instance.setBulletManager(id, bullet);\r\n    }\r\n}"]}